---
description: 论文章节定稿工作流程 - 将评审通过的章节进行最终处理
---

# 论文定稿 Workflow

## 适用场景

当某个章节通过 `/expert-review` 获得 **S级（优秀）** 评审后，使用本工作流进行最终定稿处理。

---

## 定稿流程概览

```
┌─────────────────────────────────────────────────────────────┐
│  Step 1: 文件重命名与迁移                                     │
│  output/第X章_标题_vN.md → final_output/第X章_标题_final.md   │
└─────────────────┬───────────────────────────────────────────┘
                  │
                  ▼
┌─────────────────────────────────────────────────────────────┐
│  Step 2: 配图代码生成                                         │
│  根据文中图表描述，编写 MATLAB 绘图代码                        │
│  保存至 final_output/figure_code/                            │
│  （用户可自行运行代码生成图片）                                │
└─────────────────┬───────────────────────────────────────────┘
                  │
                  ▼
┌─────────────────────────────────────────────────────────────┐
│  Step 3: 更新文档中的图片路径                                  │
│  确保 Markdown 中的图片链接指向正确位置                        │
└─────────────────────────────────────────────────────────────┘
```

---

## 目录结构

```
/Users/mac/Desktop/lunwx/.agent/workflows/
├── output/                    # 草稿和迭代版本
│   ├── 第3章_3.3_xxx_v1.md
│   ├── 第3章_3.3_xxx_v2.md
│   └── figures/               # 临时图表
├── final_output/              # 🆕 最终定稿目录
│   ├── 第3章_3.3_xxx_final.md # 定稿文档
│   ├── figures/               # 最终配图（用户运行代码后生成）
│   │   ├── 图3-4_时延演化轨迹.png
│   │   ├── 图3-5_频谱散焦对比.png
│   │   └── 图3-6_带宽散焦耦合.png
│   └── figure_code/           # 绘图代码（MATLAB）
│       ├── plot_fig_3_4.m
│       ├── plot_fig_3_5.m
│       └── plot_fig_3_6.m
└── thesis-code/               # 共享：仿真参考代码
```

---

## Step 1: 文件重命名与迁移

### 命令格式
```
请将评审通过的章节定稿：
- 源文件：output/第X章_章节标题_vN.md
- 目标：final_output/第X章_章节标题_final.md
```

### 示例
```
请将评审通过的章节定稿：
- 源文件：output/第3章_3.3_色散效应对差频信号的调制机理与误差解析_v3.md
- 目标：final_output/第3章_3.3_色散效应对差频信号的调制机理与误差解析_final.md
```

### 操作规范
1. 复制文件到 `final_output/` 目录
2. 重命名后缀为 `_final.md`
3. 保留原始版本在 `output/` 中作为历史记录

---

## Step 2: 配图代码生成

### ⚠️ 强制要求：基于原文内容编写代码

**在生成任何绘图代码之前，必须**：

1. **阅读定稿文档**：打开 `final_output/第X章_xxx_final.md`
2. **提取图表描述**：找到文中对每个图表的具体描述
3. **理解物理意义**：明确图表要展示的物理现象和数值特征
4. **匹配代码逻辑**：根据文档描述编写对应的 MATLAB 代码

**示例**：

如果文档中写道：
> "图 3-4 对比了无色散与强色散条件下的群时延演化轨迹。在理想无色散信道（$A_1=A_2=0$）中，时延表现为恒定直线；而在强色散区（$f_p=29$ GHz），曲线呈现出显著的向下倾斜与弯曲。"

则代码必须：
- ✅ 绘制两条曲线：无色散（恒定直线）和强色散（弯曲曲线）
- ✅ 使用 $f_p = 29$ GHz 作为强色散参数
- ✅ 标注"向下倾斜"和"弯曲"的物理特征

---

### 代码编写流程

```
Step 2.1: 阅读定稿文档
  ↓
Step 2.2: 提取图表信息
  - 图表编号（如 图 3-4）
  - 物理量（如 时延 vs 时间）
  - 参数设置（如 f_p = 29 GHz）
  - 曲线特征（如 恒定直线、向下倾斜、弯曲）
  ↓
Step 2.3: 参考 thesis-code
  - 查找相关的物理计算逻辑
  - 确保参数一致性
  ↓
Step 2.4: 编写绘图代码
  - 实现文档中描述的所有特征
  - 使用论文标准绘图风格
```

---

### 代码编写规范

绘图代码需参考 [thesis-code](file:///Users/mac/Desktop/lunwx/.agent/workflows/thesis-code/) 中的仿真逻辑，确保：
1. **参数一致性**：与仿真代码使用相同的物理参数
2. **风格统一**：字体、线宽、颜色与论文整体风格一致
3. **可复现性**：代码可独立运行，不依赖额外变量

### 参考代码资源

| 图表类型 | 参考代码 | 核心函数 |
|---------|---------|---------|
| 群时延曲线 | `nue.m` | 群时延计算、敏感性分析 |
| 频谱图 | `initial.m` | FFT分析、频谱绘制 |
| 工程判据图 | `lianghua.m` | η因子计算、边界曲线 |
| 反演结果图 | `LM.m` | 加权LM算法、误差分析 |

### 绘图代码模板

```matlab
%% plot_fig_3_X.m
% 论文图 3-X：[图表标题]
% 生成日期：YYYY-MM-DD
% 对应章节：3.X.X [章节名称]

clear; clc; close all;

%% 1. 参数设置（与 thesis-code 保持一致）
c = 3e8;                    % 光速 (m/s)
epsilon_0 = 8.854e-12;      % 真空介电常数
m_e = 9.109e-31;            % 电子质量 (kg)
q_e = 1.602e-19;            % 电子电量 (C)

% 等离子体参数
n_e = 1.04e19;              % 电子密度 (m^-3)
nu_e = 1.5e9;               % 碰撞频率 (Hz)
d = 0.15;                   % 等离子体厚度 (m)

% 雷达参数
f0 = 34e9;                  % 中心频率 (Hz)
B = 4e9;                    % 带宽 (Hz)
T_m = 1e-3;                 % 扫频周期 (s)

% 等离子体截止频率
f_p = (1/(2*pi)) * sqrt(n_e * q_e^2 / (epsilon_0 * m_e));

%% 2. 计算 [具体物理量]
% ... [计算代码]

%% 3. 绘图
figure('Position', [100, 100, 800, 600]);

% 论文标准绘图设置
set(gca, 'FontName', 'Times New Roman', 'FontSize', 12);
set(gca, 'LineWidth', 1.2);
grid on; box on;

% 绑定 legend
legend('Location', 'best', 'FontSize', 10);

% 坐标轴标签
xlabel('[X轴物理量] / [单位]', 'FontSize', 14);
ylabel('[Y轴物理量] / [单位]', 'FontSize', 14);
title('图 3-X [图表标题]', 'FontSize', 14, 'FontWeight', 'bold');

%% 4. 保存图表
% 保存为 PNG（高分辨率）
print('-dpng', '-r300', 'final_output/figures/图3-X_标题.png');

% 保存为 SVG（矢量图，用于排版）
print('-dsvg', 'final_output/figures/图3-X_标题.svg');

fprintf('图 3-X 已保存至 final_output/figures/\n');
```

### 绘图风格规范

```matlab
% 标准颜色方案（论文统一风格）
colors = [
    0.0000, 0.4470, 0.7410;  % 蓝色 - 主曲线
    0.8500, 0.3250, 0.0980;  % 橙色 - 对比曲线
    0.9290, 0.6940, 0.1250;  % 黄色 - 辅助曲线
    0.4940, 0.1840, 0.5560;  % 紫色 - 特殊标注
    0.4660, 0.6740, 0.1880;  % 绿色 - 验证数据
];

% 线型设置
line_styles = {'-', '--', ':', '-.'};  % 实线、虚线、点线、点划线

% 标准线宽
line_width_main = 2.0;      % 主曲线
line_width_secondary = 1.5; % 次要曲线
line_width_grid = 0.5;      % 网格线

% 标记设置（用于实验数据点）
marker_size = 8;
marker_types = {'o', 's', '^', 'd', 'v'};  % 圆、方、上三角、菱形、下三角
```

---

### 用户自行运行代码生成图片（可选）

生成绘图代码后，用户可以自行在 MATLAB 中运行这些代码来生成图片：

**操作步骤**：
1. 打开 MATLAB
2. 切换到代码目录：
   ```matlab
   cd('/Users/mac/Desktop/lunwx/.agent/workflows/final_output/figure_code');
   ```
3. 运行绘图脚本：
   ```matlab
   run('plot_fig_3_4.m');  % 生成图 3-4
   run('plot_fig_3_5.m');  % 生成图 3-5
   run('plot_fig_3_6.m');  % 生成图 3-6
   ```
4. 检查输出：图片会自动保存到 `final_output/figures/` 目录

**图表输出规范**：

| 格式 | 用途 | 分辨率 |
|-----|-----|-------|
| PNG | 预览、Word 插入 | 300 DPI |
| SVG | LaTeX 排版、矢量编辑 | 矢量 |

**文件命名示例**：
```
图3-4_时延演化轨迹对比.png
图3-5_频谱散焦效应.svg
图3-6_带宽散焦耦合曲线.png
```

---

## Step 3: 更新文档中的图片路径

### 路径格式
```markdown
![图3-4 时延演化轨迹对比](file:///Users/mac/Desktop/lunwx/.agent/workflows/final_output/figures/图3-4_时延演化轨迹对比.png)
```

### 批量替换命令
```
请更新 final_output/第3章_3.3_xxx_final.md 中的所有图片路径，
使其指向 final_output/figures/ 目录下的实际图片文件。
```

---

## 定稿命令示例

### 完整定稿流程
```
/finalize

请对以下章节执行完整的定稿流程：

【章节信息】
- 章节编号：3.3
- 章节标题：色散效应对差频信号的调制机理与误差解析
- 源文件：output/第3章_3.3_色散效应对差频信号的调制机理与误差解析_v3.md
- 评审状态：S级（已通过）

【定稿文档路径】（必须提供）
- final_output/第3章_3.3_色散效应对差频信号的调制机理与误差解析_final.md

【需要生成的图表】
请阅读定稿文档，提取以下图表的具体描述：
- 图 3-4：时延演化轨迹对比
  - 文档位置：第X段
  - 关键描述：[从文档中提取]
  
- 图 3-5：频谱散焦效应
  - 文档位置：第Y段
  - 关键描述：[从文档中提取]
  
- 图 3-6：带宽-散焦非线性耦合曲线
  - 文档位置：第Z段
  - 关键描述：[从文档中提取]

【执行步骤】
1. 将 v3 版本复制到 final_output/ 并重命名为 _final.md
2. **阅读 final.md 文档**，提取每个图表的详细描述
3. 根据文档描述，为每个图表编写 MATLAB 绘图代码
4. 参考 thesis-code/ 确保参数和计算逻辑一致
5. 更新文档中的图片路径
```

### 仅生成配图代码（基于已有定稿文档）
```
/finalize

请基于定稿文档生成配图代码：

【定稿文档】
- 路径：final_output/第3章_3.3_xxx_final.md

【任务】
1. 阅读文档，找到所有图表引用（图 3-X）
2. 提取每个图表的描述（包括物理量、参数、曲线特征）
3. 为每个图表生成对应的 MATLAB 代码

【示例输出】
对于图 3-4，文档中的描述为：
"图 3-4 对比了无色散与强色散条件下的群时延演化轨迹..."

生成的代码应包含：
- 两条曲线（无色散 vs 强色散）
- 参数 f_p = 29 GHz
- 标注"向下倾斜"和"弯曲"特征
```

---

## 定稿检查清单

在完成定稿前，确认以下事项：

### 文档检查
- [ ] 文件已重命名为 `_final.md`
- [ ] 文件已移动到 `final_output/` 目录
- [ ] 原始版本保留在 `output/` 作为历史记录

### 图表检查
- [ ] **已阅读定稿文档**：仔细阅读了 `final.md` 中的所有图表描述
- [ ] **代码与文档一致**：生成的代码完全符合文档中的描述
- [ ] 所有图表编号连续（图 3-1, 3-2, 3-3...）
- [ ] 绘图代码保存在 `figure_code/` 目录
- [ ] 图片文件保存在 `figures/` 目录
- [ ] 文档中的图片路径已更新为正确位置

### 内容检查
- [ ] 图文融合完整（无独立占位块）
- [ ] 公式编号与正文引用一致
- [ ] 参数与仿真代码一致
- [ ] **图表特征与文档描述一致**（如"恒定直线"、"向下倾斜"等）

### 代码检查
- [ ] 绘图代码可独立运行
- [ ] 参数与 `thesis-code/` 一致
- [ ] **物理量与文档描述一致**（如 X轴、Y轴、曲线数量）
- [ ] 图片输出格式正确（PNG 300DPI + SVG）
- [ ] **代码注释说明了与文档的对应关系**

---

## 快速操作命令

### 执行完整定稿
```
/finalize 3.3 色散效应对差频信号的调制机理与误差解析
```

### 仅迁移文件
```
/finalize --migrate output/第3章_3.3_xxx_v3.md
```

### 仅生成配图
```
/finalize --figures 3.3
```

### 仅更新路径
```
/finalize --update-paths final_output/第3章_3.3_xxx_final.md
```

---

## 输出语言与代码格式

- **文档语言**：中文（学术风格）
- **代码语言**：MATLAB
- **代码注释**：中文 + 关键术语英文
- **图片格式**：PNG（300 DPI）+ SVG（矢量）
