# 4.3 基于Metropolis-Hastings的贝叶斯参数反演模型

第4.2节建立的"滑动窗口-MDL-ESPRIT"框架从强色散差频信号中重构了特征轨迹$\mathcal{D} = \{(f_{probe,i}, \tau_{meas,i}, A_i)\}_{i=1}^{N_w}$，包含探测频率、测量时延和幅度权重三维信息。然而，从特征数据到物理参数的反演仍面临两个挑战：如何构建同时利用时延与幅度信息的目标函数；如何量化反演不确定性，验证第4.1节的参数降维假设。

传统确定性优化方法（如Levenberg-Marquardt算法）属于局部搜索策略，收敛路径依赖初始猜测点，且仅返回单一最优解$\hat{\mathbf{\theta}}$，无法量化参数置信区间或揭示主参数$n_e$与次级参数$\nu_e$间的耦合关系。鉴于此，本节引入贝叶斯统计框架，利用马尔可夫链蒙特卡洛（MCMC）方法从后验概率分布视角审视反演问题。

本节围绕三个核心环节展开：（1）构建融合幅度权重$A_i$的加权似然函数，使高信噪比数据主导反演过程；（2）设计均匀先验分布并采用Metropolis-Hastings算法实现后验采样，克服对初值的依赖；（3）基于后验分布形态建立参数可观测性量化判据，为第4.4节仿真验证奠定方法论基础。

---

## 4.3.1 加权似然函数构建：融合碰撞频率幅度衰减的权重设计

### 从最小二乘到贝叶斯：反演范式的转换

根据贝叶斯定理，待反演参数$\mathbf{\theta}$的后验分布正比于似然函数与先验分布的乘积：

$$P(\mathbf{\theta} | \mathcal{D}) = \frac{P(\mathcal{D} | \mathbf{\theta}) \cdot P(\mathbf{\theta})}{P(\mathcal{D})} \propto P(\mathcal{D} | \mathbf{\theta}) \cdot P(\mathbf{\theta}) \tag{4-42}$$

其中$\mathcal{D}$为ESPRIT提取的观测数据集，$\mathbf{\theta} = [n_e, \nu_e]^T$为待反演参数向量。式(4-42)表明后验分布综合了观测数据的"似然证据"与物理约束的"先验知识"。相比传统最小二乘仅关注残差极小化，贝叶斯框架不仅给出参数最可能值，更提供完整概率分布以量化不确定性。这种从"点估计"到"分布估计"的范式转换，是验证参数可观测性假设的理论基础。

### 加权高斯似然函数的物理构造

似然函数$P(\mathcal{D} | \mathbf{\theta})$衡量给定参数下观测数据出现的概率。假设测量误差服从高斯分布，基准噪声标准差$\sigma_0 = 0.1$ ns（由标定实验确定），单个数据点的似然贡献为：

$$P(\tau_{meas,i} | \mathbf{\theta}) \propto \exp\left( -\frac{(\tau_{meas,i} - \tau_{model}(f_{probe,i}; \mathbf{\theta}))^2}{2\sigma_0^2} \right) \tag{4-43}$$

其中$\tau_{model}(f; \mathbf{\theta})$为Drude理论模型计算的群时延。然而，当$f_{probe}$接近截止频率$f_p$时，信号幅度急剧衰减，信噪比恶化。若对所有数据点赋予等权重，低信噪比区域的噪声将主导残差计算，掩盖高质量数据携带的物理信息。

为此，本文引入基于幅度的自适应加权机制，利用式(4-21)的窗口幅度$A_i$定义归一化权重：

$$w_i = \left( \frac{A_i}{\max(\mathbf{A})} \right)^2 \tag{4-44}$$

幅度$A_i$反映窗口内信号能量，与信噪比正相关；平方处理进一步放大权重差异，使透射窗口内的高质量数据主导反演，截止频率附近的低质量数据自动降权。该策略将"幅度对$\nu_e$敏感、时延对$n_e$敏感"的解耦特性融入算法设计。

引入加权因子后，加权对数似然函数的最终形式为：

$$\ln \mathcal{L}(\mathbf{\theta}) = -\frac{1}{2\sigma_0^2} \sum_{i=1}^{N_w} w_i \left( \tau_{meas,i} - \tau_{model}(f_{probe,i}; \mathbf{\theta}) \right)^2 \tag{4-45}$$

式(4-45)是本文贝叶斯反演的核心公式。与加权最小二乘不同，贝叶斯框架将其作为后验分布的一个因子，通过MCMC采样获取参数的完整概率信息。

### 理论时延模型的数值实现

加权似然函数的计算依赖于理论时延$\tau_{model}(f; \mathbf{\theta})$的精确求值。由电子密度$n_e$计算等离子体特征角频率$\omega_p = \sqrt{n_e e^2/(\varepsilon_0 m_e)}$，进而得到含阻尼效应的复介电常数：

$$\tilde{\varepsilon}_r(\omega) = 1 - \frac{\omega_p^2}{\omega(\omega + j\nu_e)} \tag{4-46}$$

由复介电常数求得复波数$\tilde{k}(\omega) = (\omega/c)\sqrt{\tilde{\varepsilon}_r(\omega)}$。电磁波穿过厚度$d$的等离子体层时，传播相位为$\Phi(\omega) = -\text{Re}\{\tilde{k}(\omega)\} \cdot d$，群时延通过数值微分并减去真空参考获得：

$$\tau_{model}(f; n_e, \nu_e) = -\frac{d\Phi}{d\omega} - \frac{d}{c} \tag{4-47}$$

式(4-46)至(4-47)构成从参数$\mathbf{\theta}$到理论时延的完整映射链。该计算采用全复数Drude模型，保留了$\nu_e$的完整物理效应，为通过后验分布形态验证其"不可观测性"提供数学基础。

---

## 4.3.2 先验分布设定与MCMC采样策略

### 均匀先验的物理约束设计

先验分布$P(\mathbf{\theta})$体现对参数取值范围的物理约束。本文对$n_e$和$\nu_e$均采用均匀分布作为先验：

$$P(n_e) = \begin{cases} \frac{1}{n_{e,max} - n_{e,min}} & \text{if } n_e \in [n_{e,min}, n_{e,max}] \\ 0 & \text{otherwise} \end{cases} \tag{4-48}$$

$$P(\nu_e) = \begin{cases} \frac{1}{\nu_{e,max} - \nu_{e,min}} & \text{if } \nu_e \in [\nu_{e,min}, \nu_{e,max}] \\ 0 & \text{otherwise} \end{cases} \tag{4-49}$$

均匀先验仅限定物理可行域而不引入主观偏好，后验形态完全由数据驱动。作为"无信息先验"的形式，其推断结果与最大似然估计具有渐近一致性。

先验边界需结合诊断系统工作频段确定。对于Ka波段LFMCW系统，电子密度设定为$n_e \in [10^{18}, 10^{20}]$ m$^{-3}$（对应$f_p \in [9, 90]$ GHz），涵盖弱电离至强电离状态；碰撞频率设定为$\nu_e \in [0.1, 5]$ GHz，覆盖低压至大气压放电工况。

### Metropolis-Hastings算法的实现框架

本文采用Metropolis-Hastings（MH）算法从式(4-42)定义的后验分布中抽取样本。MH算法通过"提议-接受/拒绝"的随机游走机制使马尔可夫链收敛至目标后验分布。其核心优势在于零阶特性——仅需计算目标函数值而无需求导，既避免了群时延在截止频率附近因导数趋于无穷大引发的数值溢出，又能适应导数不连续的物理模型。

算法从先验分布均匀采样初始状态$\mathbf{\theta}^{(0)}$并计算初始对数似然。随后基于当前状态$\mathbf{\theta}^{(t)}$通过高斯随机游走生成候选状态：

$$\mathbf{\theta}' = \mathbf{\theta}^{(t)} + \boldsymbol{\epsilon}, \quad \boldsymbol{\epsilon} \sim \mathcal{N}(\mathbf{0}, \boldsymbol{\Sigma}_{prop}) \tag{4-50}$$

其中$\boldsymbol{\Sigma}_{prop} = \text{diag}(\sigma_{n_e}^2, \sigma_{\nu_e}^2)$为提议分布协方差矩阵，$\sigma_{n_e}$和$\sigma_{\nu_e}$分别设为先验范围的2%和5%。较大的$\nu_e$提议步长考虑了其对时延的低敏感性。

若候选状态超出先验边界则直接拒绝；否则计算Metropolis接受概率：

$$\alpha = \min\left(1, \frac{P(\mathbf{\theta}' | \mathcal{D})}{P(\mathbf{\theta}^{(t)} | \mathcal{D})}\right) = \min\left(1, \exp(\ln\mathcal{L}(\mathbf{\theta}') - \ln\mathcal{L}(\mathbf{\theta}^{(t)}))\right) \tag{4-51}$$

由于采用均匀先验且提议分布对称，式(4-51)简化为似然比形式。生成均匀随机数$u \sim U(0,1)$后，若$u < \alpha$则接受候选状态，否则保持当前状态。这种"概率性接受"机制允许链以一定概率接受似然较低的状态，从而避免陷入局部极值。重复迭代$N_{samples} = 10000$次生成完整马尔可夫链。

### 预烧期与后验统计

马尔可夫链前若干样本受初始状态影响尚未收敛，称为"预烧期"。本文设定$N_{burn} = 2000$次迭代（占总采样数20%），预烧期样本不参与后验统计。预烧期可通过迹线图判断：链轨迹围绕稳定值波动而非趋势性漂移时即进入平稳状态。

迹线图是诊断MCMC收敛性的基本工具。可观测参数的迹线在预烧期后应稳定围绕固定值波动，呈现"混合良好"特征；弱可观测或不可观测参数则在先验范围内大幅漫游。这种行为差异直观预示了参数可观测性的本质区别。

图4-7展示了基于真实LFMCW信号（SNR = 20 dB）的MCMC迹线图仿真结果。仿真参数设置为：电子密度真值$n_e = 1.35 \times 10^{19}$ m$^{-3}$，碰撞频率真值$\nu_e = 1.5$ GHz，总采样数10000次，预烧期2000次。结果表明：$n_e$迹线在预烧期后迅速收敛至真值附近并保持窄幅振荡（CV = 0.6%，强可观测），后验均值$1.356 \times 10^{19}$ m$^{-3}$与真值偏差仅0.4%；$\nu_e$迹线虽在先验范围$[0.1, 5]$ GHz内大幅波动，但后验均值3.37 GHz仍在同一数量级（CV = 23.7%，弱可观测），表明数据对$\nu_e$提供了一定约束但精度受限。

丢弃预烧期后，有效样本集为$\{\mathbf{\theta}^{(t)}\}_{t=N_{burn}+1}^{N_{samples}}$，共8000个样本。后验均值$\hat{\theta}$、标准差$\sigma_\theta$及95%置信区间$[\theta_{2.5\%}, \theta_{97.5\%}]$可直接计算。

### 采样效率与收敛诊断

MH算法的采样效率用"接受率"衡量。理论分析表明，多维高斯目标分布的最优接受率约23%，一般目标分布20%-50%为合理区间。接受率过高表示步长过小、探索效率低；过低则表示步长过大、链频繁原地踏步。

本文采用迹线图和自相关分析诊断收敛性。收敛的链在迹线图上表现为围绕稳定值的随机波动；自相关函数应在若干滞后步后迅速衰减至零。通过直方图可视化边缘后验分布：可观测参数呈现单峰紧凑形态，不可观测参数呈现平坦或多峰特征，这是建立可观测性判据的基础。

---

## 4.3.3 参数可观测性判据：基于后验分布宽度的量化标准

### 从后验形态到可观测性：物理直觉的数学表达

第4.1节论证了$\nu_e$对群时延的影响仅为$O((\nu_e/\omega)^2)$的二阶微扰，据此提出参数降维策略。MCMC方法提供了直接验证途径：若某参数对观测数据影响微弱，其后验分布将保持接近先验的"平坦"形态，而非收敛至窄峰。

这一物理直觉可形式化为参数可观测性的量化判据。定义后验变异系数（CV）：

$$\text{CV}_\theta = \frac{\sigma_\theta^{(post)}}{\hat{\theta}^{(post)}} \tag{4-52}$$

其中$\sigma_\theta^{(post)}$和$\hat{\theta}^{(post)}$分别为后验标准差和均值。CV衡量后验分布的弥散程度：CV趋近零时后验坍缩为尖锐峰，参数被精确约束；CV趋近先验CV值（均匀分布约57.7%）时，后验几乎未从先验更新，表明数据对该参数不携带有效信息。

基于系统性仿真验证，本文归纳出如下四级工程判据（表4-1）：

| CV范围 | 可观测性等级 | 工程含义 |
|:------:|:----------:|:--------|
| CV < 5% | 强可观测 | 高精度反演，稳定可靠 |
| 5% ≤ CV < 15% | 中等可观测 | 可信反演，但精度受限 |
| 15% ≤ CV < 30% | 弱可观测 | 可被数据约束，偏差显著 |
| CV ≥ 30% | 不可观测 | 由先验主导，建议固定 |

该判据将参数可观测性从二元分类（"可观测/不可观测"）细化为四级分类，更准确地刻画了物理参数被数据约束的程度。

### Corner Plot：参数耦合的可视化诊断

本文采用角点图（Corner Plot）可视化参数间联合后验分布：主对角线展示边缘后验直方图及CV值，下三角展示联合分布散点图，右上区域标注参数相关分析结果。

Corner Plot可直观揭示参数耦合信息。联合分布呈圆形表明两者独立，呈倾斜椭圆表明存在相关性。更重要的是，若某参数边缘后验呈尖锐峰而另一参数呈较平坦形态，联合分布将表现为"长条"结构——长轴方向对应弱可观测参数，短轴方向对应强可观测参数。若联合分布存在多个分离高概率区域，则表明反演问题存在多解性。

图4-8展示了与图4-7相同仿真条件下的Corner Plot结果。边缘后验分布清晰揭示了两参数的可观测性差异：$n_e$边缘后验呈现尖锐窄峰（CV = 0.6%），峰值精确落在真值位置；$\nu_e$边缘后验相对平坦但仍呈现一定聚集趋势（CV = 23.7%），属于"弱可观测"状态。

联合后验散点图呈现特征性的"纵向长条"结构：$n_e$被数据强约束在$[1.34, 1.37] \times 10^{19}$ m$^{-3}$的窄带内（95% CI），而$\nu_e$在$[2.0, 4.9]$ GHz范围内弥散。参数相关系数$\rho_{n_e,\nu_e} = 0.23$表明两者弱耦合，可独立反演。该结果从统计视角验证了第4.1节的物理预判：$n_e$可被精确反演，$\nu_e$虽受数据约束但反演精度有限。第4.4节将基于系统性仿真进一步量化不同信噪比条件下的可观测性边界。

### 可观测性判据的工程应用

本文建立的可观测性分析流程为：对候选参数集$\mathbf{\theta} = [n_e, \nu_e]^T$运行MCMC采样，计算各参数后验CV值并按表4-1进行四级分类；绘制Corner Plot检查参数耦合，若$|\rho| > 0.7$则考虑重新参数化以解耦；根据可观测性等级确定反演策略：强可观测参数独立反演，弱可观测参数需附带较宽置信区间，不可观测参数固定为经验常数。

该流程的核心价值在于将"参数是否应该反演"从主观经验提升为客观的数据驱动决策。CV判据具有可重复性和可移植性，可直接应用于第5章的Lorentz超材料模型和Butterworth滤波器模型。

### 算法鲁棒性的特异性分析

与传统LM算法相比，MCMC方法展现出两个独特优势。其一为**初值无关性**：LM算法作为局部搜索方法，收敛路径依赖初始猜测点的"吸引域"；MCMC基于马尔可夫链遍历性定理，链的状态分布收敛于唯一的目标后验分布而与初始状态无关。仿真表明，即便初始电子密度偏离真值500%，约2000次迭代后采样链仍能收敛至真值附近。

其二为**奇点适应能力**：在截止频率或谐振点附近，群时延曲线出现陡峭突变，导致LM算法的雅可比矩阵奇异或病态。MCMC仅需计算似然函数值而无需求导，当随机游走至突变点时，似然概率趋近零，Metropolis判据将拒绝该跳跃，迫使采样链自动绕开奇点区域，赋予算法处理非平滑色散曲线的稳定性。

---

## 本节小结

本节建立了基于Metropolis-Hastings MCMC的贝叶斯参数反演框架，为第4.2节提取的特征数据与Drude物理模型搭建了统计推断桥梁。

在加权似然函数设计方面，针对信噪比随频率变化的特点，构建了融合幅度权重的加权高斯似然函数（式4-45），使高信噪比数据主导反演过程；同时给出了基于全复数Drude模型的理论时延计算流程（式4-46至4-47）。

在MCMC采样策略方面，采用均匀先验分布限定物理可行域，基于MH算法实现后验采样。算法设置包括总采样数10000次、预烧期2000次、提议步长分别为参数范围的2%（$n_e$）和5%（$\nu_e$），充分利用了MCMC的初值无关性和奇点适应能力。

在参数可观测性判据方面，建立了以变异系数CV为核心的四级分类标准（表4-1）：CV < 5%为强可观测，5%-15%为中等可观测，15%-30%为弱可观测，CV ≥ 30%为不可观测。基于真实LFMCW信号（SNR = 20 dB）的仿真验证表明：$n_e$的CV = 0.6%（强可观测），$\nu_e$的CV = 23.7%（弱可观测），两者相关系数$\rho = 0.23$表明弱耦合、可独立反演。Corner Plot清晰揭示了$n_e$的"尖峰"后验与$\nu_e$的"较平坦"后验之间的对比，从统计学角度验证了第4.1节的物理预判。该判据将"参数是否应该反演"从主观经验提升为数据驱动决策，为第4.4节的系统性仿真验证提供了定量化工具。
