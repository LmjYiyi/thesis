# 4.3 基于Metropolis-Hastings的贝叶斯参数反演模型

第4.2节建立了基于"滑动窗口-MDL-ESPRIT"的高分辨率特征提取框架，成功地从强色散条件下的非平稳差频信号中重构出清晰的"频率-时延"特征轨迹$\mathcal{D} = \{(f_{probe,i}, \tau_{meas,i}, A_i)\}_{i=1}^{N_w}$。该数据集同时包含探测频率、测量时延和幅度权重三维信息，为后续参数反演提供了完备的观测输入。然而，从特征数据到物理参数的反演过程仍面临两个关键挑战：一是如何构建能够同时利用时延信息和幅度信息的优化目标函数；二是如何量化反演结果的不确定性，从统计学角度验证第4.1节提出的"参数降维假设"。

传统的确定性优化方法（如Levenberg-Marquardt算法）虽然能够实现参数的快速迭代求解，但本质上属于局部搜索策略，其收敛路径严格依赖于初始猜测点的选取。更重要的是，确定性方法仅返回单一的最优解$\hat{\mathbf{\theta}}$，无法量化由测量噪声和模型误差引起的参数置信区间，也难以直观揭示主参数（电子密度$n_e$）与次级参数（碰撞频率$\nu_e$）之间的耦合关系。鉴于此，本节引入贝叶斯统计推断框架，利用马尔可夫链蒙特卡洛（Markov Chain Monte Carlo, MCMC）方法对参数空间进行全局采样，从后验概率分布的视角重新审视反演问题。

本节的技术路线是：首先构建融合物理约束的加权似然函数，将第4.2.1节提取的幅度权重$A_i$显式纳入优化目标，实现高信噪比区域对反演的主导作用；其次，基于物理先验知识设计参数的均匀先验分布，并采用Metropolis-Hastings算法实现后验分布的高效采样；最后，通过后验分布的形态特征——尖锐度与宽度——建立参数可观测性的量化判据，为第4.4节的仿真验证奠定方法论基础。

---

## 4.3.1 加权似然函数构建：融合碰撞频率幅度衰减的权重设计

### 从最小二乘到贝叶斯：反演范式的转换

根据贝叶斯定理，待反演参数集$\mathbf{\theta}$的后验分布$P(\mathbf{\theta} | \mathcal{D})$正比于似然函数$P(\mathcal{D} | \mathbf{\theta})$与先验分布$P(\mathbf{\theta})$的乘积：

$$P(\mathbf{\theta} | \mathcal{D}) = \frac{P(\mathcal{D} | \mathbf{\theta}) \cdot P(\mathbf{\theta})}{P(\mathcal{D})} \propto P(\mathcal{D} | \mathbf{\theta}) \cdot P(\mathbf{\theta}) \tag{4-42}$$

其中，$\mathcal{D} = \{(f_{probe,i}, \tau_{meas,i}, A_i)\}_{i=1}^{N_w}$为经由ESPRIT算法提取的观测数据集。在Drude等离子体模型中，待反演参数向量$\mathbf{\theta} = [n_e, \nu_e]^T$包含电子密度和碰撞频率两个分量。式(4-42)的物理意义极为深刻：后验分布综合了观测数据提供的"似然证据"与物理约束提供的"先验知识"，两者的乘积决定了参数的可信程度分布。

相比于传统最小二乘方法仅关注残差平方和的极小化，贝叶斯框架的核心优势在于：它不仅给出参数的"最可能值"（后验众数或均值），更提供了完整的概率分布，从而自然地量化了反演的不确定性。这种从"点估计"到"分布估计"的范式转换，正是后续验证参数可观测性假设的理论基础。

### 加权高斯似然函数的物理构造

似然函数$P(\mathcal{D} | \mathbf{\theta})$衡量了在给定参数$\mathbf{\theta}$下，观测数据$\mathcal{D}$出现的概率。假设测量误差服从高斯分布，基准噪声标准差为$\sigma_0$（本系统通过标定实验确定为0.1 ns），则单个数据点的似然贡献为：

$$P(\tau_{meas,i} | \mathbf{\theta}) \propto \exp\left( -\frac{(\tau_{meas,i} - \tau_{model}(f_{probe,i}; \mathbf{\theta}))^2}{2\sigma_0^2} \right) \tag{4-43}$$

其中，$\tau_{model}(f; \mathbf{\theta})$为第3.1节建立的Drude理论模型计算的群时延。然而，如第4.1.1节所分析，当探测频率$f_{probe}$接近截止频率$f_p$时，信号幅度急剧衰减（见图4-1右轴），信噪比严重恶化，导致该区域的测量数据可靠性显著下降。若对所有数据点赋予相等权重，低信噪比区域的噪声将主导残差计算，反而掩盖高信噪比区域携带的精确物理信息。

为了解决这一问题，本文引入基于幅度的自适应加权机制。利用第4.2.1节式(4-21)提取的窗口幅度$A_i$，定义归一化权重因子：

$$w_i = \left( \frac{A_i}{\max(\mathbf{A})} \right)^2 \tag{4-44}$$

该权重设计的物理逻辑如下：幅度$A_i$直接反映了第$i$个窗口内的信号能量，而信号能量与信噪比正相关。平方处理进一步放大了高低信噪比之间的权重差异，使得透射窗口内（远离截止频率）的高质量数据在反演中占据主导地位，而截止频率附近的低质量数据被自动"降权"。这种加权策略巧妙地将第4.1.1节揭示的"幅度对$\nu_e$敏感、时延对$n_e$敏感"的解耦特性融入了算法设计——虽然未显式反演碰撞频率，却通过幅度权重隐式利用了其物理效应。

将加权因子$w_i$引入式(4-43)，并对所有$N_w$个数据点取乘积，得到加权对数似然函数的最终形式：

$$\ln \mathcal{L}(\mathbf{\theta}) = -\frac{1}{2\sigma_0^2} \sum_{i=1}^{N_w} w_i \left( \tau_{meas,i} - \tau_{model}(f_{probe,i}; \mathbf{\theta}) \right)^2 \tag{4-45}$$

式(4-45)是本文贝叶斯反演框架的核心公式。其与传统加权最小二乘的形式虽然类似，但本质区别在于：后者将式(4-45)的极大化作为最终目标（点估计），而贝叶斯框架将其作为后验分布的一个因子（分布估计），通过MCMC采样获得参数的完整概率信息。

### 理论时延模型的数值实现

加权似然函数的计算依赖于理论时延$\tau_{model}(f; \mathbf{\theta})$的精确求值。根据第3.1节的推导，Drude模型下等离子体的群时延可通过复介电常数和传播相位的数值微分获得。具体步骤如下：

首先，由电子密度$n_e$计算等离子体特征角频率：

$$\omega_p = \sqrt{\frac{n_e e^2}{\varepsilon_0 m_e}} \tag{4-46}$$

其次，计算复介电常数（含碰撞频率$\nu_e$的阻尼效应）：

$$\tilde{\varepsilon}_r(\omega) = 1 - \frac{\omega_p^2}{\omega(\omega + j\nu_e)} \tag{4-47}$$

再次，由复介电常数求复波数$\tilde{k}(\omega) = (\omega/c)\sqrt{\tilde{\varepsilon}_r(\omega)}$，并计算等离子体层（厚度$d$）引起的传播相位：

$$\Phi(\omega) = -\text{Re}\{\tilde{k}(\omega)\} \cdot d \tag{4-48}$$

最后，通过数值微分求群时延$\tau_g = -d\Phi/d\omega$，并减去真空参考$d/c$得到相对群时延：

$$\tau_{model}(f; n_e, \nu_e) = -\frac{d\Phi}{d\omega} - \frac{d}{c} \tag{4-49}$$

式(4-46)至(4-49)构成了从参数$\mathbf{\theta} = [n_e, \nu_e]^T$到理论时延的完整映射链。在每一步MCMC迭代中，该映射被调用以计算候选参数的似然值。值得指出的是，该计算采用了全复数Drude模型，保留了碰撞频率$\nu_e$的完整物理效应（虽然如第4.1.1节所论证，其对群时延的贡献仅为二阶小量），这为后续通过后验分布形态验证$\nu_e$的"不可观测性"提供了数学基础。

---

## 4.3.2 先验分布设定与MCMC采样策略

### 均匀先验的物理约束设计

先验分布$P(\mathbf{\theta})$体现了在观测数据之前，对参数可能取值范围的物理约束。本文对电子密度$n_e$和碰撞频率$\nu_e$均采用均匀分布（Uniform Distribution）作为先验：

$$P(n_e) = \begin{cases} \frac{1}{n_{e,max} - n_{e,min}} & \text{if } n_e \in [n_{e,min}, n_{e,max}] \\ 0 & \text{otherwise} \end{cases} \tag{4-50}$$

$$P(\nu_e) = \begin{cases} \frac{1}{\nu_{e,max} - \nu_{e,min}} & \text{if } \nu_e \in [\nu_{e,min}, \nu_{e,max}] \\ 0 & \text{otherwise} \end{cases} \tag{4-51}$$

均匀先验的选择具有深刻的方法论意义。首先，它仅限定了参数的物理可行域，在域内不引入任何人为的主观偏好，保证了推断的客观性——后验分布的形态完全由观测数据驱动。其次，均匀先验是"无信息先验"（Non-informative Prior）的一种形式，在缺乏特定先验知识时被广泛采用，其推断结果与频率学派的最大似然估计具有渐近一致性。

先验边界的具体取值需要结合诊断系统的工作频段和等离子体的典型参数范围确定。对于Ka波段（34-37 GHz）LFMCW系统，设定：

- 电子密度：$n_e \in [10^{18}, 10^{20}]$ m$^{-3}$，对应截止频率约$f_p \in [9, 90]$ GHz，涵盖了从弱电离到强电离的典型等离子体状态；
- 碰撞频率：$\nu_e \in [0.1, 5]$ GHz，覆盖了从低压放电（$\nu_e \sim 0.1$ GHz）到大气压放电（$\nu_e \sim 5$ GHz）的工况范围。

上述边界设定确保了在物理合理的参数空间内进行采样，同时避免了因边界过窄导致的先验截断效应或因边界过宽导致的采样效率下降。

### Metropolis-Hastings算法的实现框架

为从式(4-42)定义的后验分布中抽取样本，本文采用Metropolis-Hastings（MH）算法构建马尔可夫链。MH算法的核心思想是：通过"提议-接受/拒绝"的随机游走机制，使马尔可夫链的平稳分布收敛至目标后验分布。与确定性优化方法相比，MH算法具有两个显著优势：一是无需计算目标函数的梯度（零阶方法），避免了群时延曲线在截止频率附近奇异性导致的数值不稳定；二是从先验分布随机初始化，克服了对初始猜测点的依赖。

算法的具体流程如下：

**步骤1（初始化）**：从先验分布均匀采样初始状态$\mathbf{\theta}^{(0)}$，计算初始对数似然$\ln\mathcal{L}(\mathbf{\theta}^{(0)})$。该初始化策略彻底摆脱了传统优化方法对人工初值猜测的依赖——即便初始点远离真值，马尔可夫链仍能通过随机游走逐步逼近高概率区域。

**步骤2（提议新状态）**：基于当前状态$\mathbf{\theta}^{(t)}$，通过对称高斯随机游走生成候选状态：

$$\mathbf{\theta}' = \mathbf{\theta}^{(t)} + \boldsymbol{\epsilon}, \quad \boldsymbol{\epsilon} \sim \mathcal{N}(\mathbf{0}, \boldsymbol{\Sigma}_{prop}) \tag{4-52}$$

其中，$\boldsymbol{\Sigma}_{prop} = \text{diag}(\sigma_{n_e}^2, \sigma_{\nu_e}^2)$为提议分布的协方差矩阵。提议步长的选择遵循经验法则：$\sigma_{n_e}$和$\sigma_{\nu_e}$分别设为参数先验范围的2%和5%。较大的$\nu_e$提议步长考虑了其对时延的低敏感性——需要更大的探索幅度才能有效采样其后验分布。

**步骤3（先验约束检查）**：若候选状态$\mathbf{\theta}'$超出先验边界，直接拒绝该提议，保持$\mathbf{\theta}^{(t+1)} = \mathbf{\theta}^{(t)}$，并跳转至下一次迭代。该步骤确保马尔可夫链严格约束在物理可行域内。

**步骤4（计算接受概率）**：若候选状态在先验域内，计算Metropolis接受概率：

$$\alpha = \min\left(1, \frac{P(\mathbf{\theta}' | \mathcal{D})}{P(\mathbf{\theta}^{(t)} | \mathcal{D})}\right) = \min\left(1, \exp(\ln\mathcal{L}(\mathbf{\theta}') - \ln\mathcal{L}(\mathbf{\theta}^{(t)}))\right) \tag{4-53}$$

由于采用均匀先验且提议分布对称，式(4-53)简化为似然比的形式。对数形式的计算有效避免了概率值极小时的数值下溢问题。

**步骤5（接受或拒绝）**：生成均匀随机数$u \sim U(0,1)$。若$u < \alpha$，接受候选状态$\mathbf{\theta}^{(t+1)} = \mathbf{\theta}'$；否则拒绝，$\mathbf{\theta}^{(t+1)} = \mathbf{\theta}^{(t)}$。该"概率性接受"机制是MH算法的精髓：它允许链以一定概率"上坡"（接受似然较低的状态），从而避免陷入局部极值，实现对后验分布的全局探索。

**步骤6（迭代循环）**：重复步骤2-5共$N_{samples}$次（本文取$N_{samples} = 10000$），生成马尔可夫链$\{\mathbf{\theta}^{(t)}\}_{t=1}^{N_{samples}}$。

### 预烧期与后验统计

马尔可夫链的前若干个样本受初始状态影响，尚未收敛至平稳分布，称为"预烧期"（Burn-in Period）。本文设定预烧期为$N_{burn} = 2000$次迭代，占总采样数的20%。预烧期的确定可通过迹线图（Trace Plot）直观判断：当链的轨迹围绕某一稳定值波动而不再呈现趋势性漂移时，即认为已进入平稳状态。

丢弃预烧期样本后，有效样本集为$\{\mathbf{\theta}^{(t)}\}_{t=N_{burn}+1}^{N_{samples}}$，共8000个样本。基于该样本集，可计算各参数的后验统计量：

- **后验均值**：$\hat{\theta} = \frac{1}{N_{samples} - N_{burn}} \sum_{t=N_{burn}+1}^{N_{samples}} \theta^{(t)}$
- **后验标准差**：$\sigma_\theta = \sqrt{\frac{1}{N_{samples} - N_{burn} - 1} \sum_{t=N_{burn}+1}^{N_{samples}} (\theta^{(t)} - \hat{\theta})^2}$
- **95%置信区间**：$[\theta_{2.5\%}, \theta_{97.5\%}]$，分别为样本分布的2.5%和97.5%分位数

上述统计量提供了参数估计的"点估计+区间估计"完整信息，为不确定性量化奠定了基础。

### 采样效率与收敛诊断

MH算法的采样效率通常用"接受率"（Acceptance Rate）衡量，即被接受的候选状态占总提议数的比例。理论分析表明，对于多维高斯目标分布，最优接受率约为23%；而对于一般目标分布，20%-50%的接受率被认为是合理的。接受率过高意味着提议步长过小，链的探索效率低下；接受率过低则意味着步长过大，链频繁"原地踏步"。

除接受率外，本文还采用以下方法诊断马尔可夫链的收敛性：

**迹线图分析**：绘制各参数随迭代次数的变化轨迹。收敛的链应表现为围绕稳定值的随机波动，而非趋势性漂移或多模态跳跃。

**自相关分析**：计算样本的自相关函数（ACF）。若ACF在若干滞后步后迅速衰减至零附近，表明样本间相关性弱，有效样本量接近名义样本量；反之，若ACF衰减缓慢，则需要进一步稀释样本（Thinning）以获得近似独立的后验样本。

**后验分布形态**：通过直方图或核密度估计可视化边缘后验分布。对于可观测参数，后验应呈现单峰、紧凑的形态；对于不可观测参数，后验将呈现平坦或多峰特征，这正是下一节建立可观测性判据的基础。

---

## 4.3.3 参数可观测性判据：基于后验分布宽度的量化标准

### 从后验形态到可观测性：物理直觉的数学表达

第4.1节从物理公式层面论证了碰撞频率$\nu_e$对群时延的影响仅为$O((\nu_e/\omega)^2)$的二阶微扰，据此提出了"固定$\nu_e$、仅反演$n_e$"的参数降维策略。然而，该论证基于解析近似，其在实际噪声环境下的有效性尚需验证。MCMC方法提供了一种直接的验证途径：若某参数对观测数据的影响微弱（即时延曲线对该参数不敏感），则无论MCMC如何采样，都难以通过数据约束该参数的取值——其后验分布将保持接近先验的"平坦"形态，而非收敛至某一窄峰。

这一物理直觉可以形式化为参数可观测性的量化判据。定义参数$\theta$的后验变异系数（Coefficient of Variation, CV）：

$$\text{CV}_\theta = \frac{\sigma_\theta^{(post)}}{\hat{\theta}^{(post)}} \tag{4-54}$$

其中，$\sigma_\theta^{(post)}$和$\hat{\theta}^{(post)}$分别为后验标准差和后验均值。变异系数衡量了后验分布的相对离散程度：CV越小，后验越集中，参数越"可观测"；CV越大，后验越分散，参数越"不可观测"。

基于仿真和实验经验，本文建立如下可观测性分级标准：

| CV范围 | 可观测性等级 | 物理含义 | 反演建议 |
|--------|-------------|---------|---------|
| CV < 5% | 强可观测 | 后验高度收敛，参数被数据精确约束 | 可直接反演，结果可信 |
| 5% ≤ CV < 20% | 中等可观测 | 后验有一定宽度，参数可辨识但精度有限 | 可反演，需报告置信区间 |
| 20% ≤ CV < 50% | 弱可观测 | 后验较宽，参数与噪声耦合明显 | 建议固定或设强先验 |
| CV ≥ 50% | 不可观测 | 后验近似均匀，参数实际上无法从数据辨识 | 必须固定，反演无意义 |

### Corner Plot：参数耦合的可视化诊断

除单参数的边缘后验分布外，参数间的联合后验分布同样承载重要信息。本文采用**角点图（Corner Plot）**作为可视化工具，它将多参数后验分布的边缘分布和两两联合分布组织在一个矩阵图中：

- **主对角线**：各参数的边缘后验分布直方图
- **下三角**：两两参数的联合后验分布散点图
- **上三角**：参数间的相关系数

Corner Plot能够直观揭示以下关键信息：

**参数耦合强度**：若两参数的联合分布呈圆形或近似圆形，表明两者独立；若呈倾斜的椭圆或"香肠"形状，表明两者存在相关性。强正相关意味着高估一个参数会导致系统地高估另一个参数，反之亦然。

**平底谷特征**：若某参数的边缘后验分布呈现平坦形态（类似于均匀分布），而另一参数呈现尖锐峰，则联合分布将表现为"横向长条"或"纵向长条"形状。这种"平底谷"结构是参数不可观测性的直接可视化证据。

**多模态结构**：若联合分布存在多个分离的高概率区域，表明反演问题存在多解性，与第3.2.3节揭示的"曲线相交"现象相呼应。此时需要引入额外约束或增加测量维度以解除模糊。

### 可观测性判据的工程应用

基于上述理论框架，本文建立的参数可观测性分析流程如下：

**第一步**：对候选参数集$\mathbf{\theta} = [n_e, \nu_e]^T$（或其他物理模型的对应参数）运行完整的MCMC采样，获得后验样本。

**第二步**：计算各参数的后验CV值。若某参数CV > 50%，判定为"不可观测"，应在后续反演中固定为经验常数。

**第三步**：绘制Corner Plot，检查参数间的耦合结构。若存在强耦合（|ρ| > 0.7），考虑参数重新参数化（Reparameterization）以解耦。

**第四步**：基于可观测性分析结果，确定最终的反演策略——保留可观测参数，固定不可观测参数——并量化反演结果的置信区间。

该流程的核心价值在于：它将"参数是否应该反演"这一决策从主观经验提升为客观的数据驱动判断。传统方法中，研究者往往基于物理直觉或试错经验决定固定哪些参数；而本文提出的CV判据提供了定量化的决策依据，具有可重复性和可移植性——相同的分析框架可直接应用于第5章的Lorentz超材料模型和Butterworth滤波器模型。

### 算法鲁棒性的特异性分析

与传统LM算法相比，MCMC方法在处理色散介质反演问题时展现出两个独特的鲁棒性优势：

**初值无关性**：LM算法作为局部搜索方法，其收敛路径严格依赖于初始猜测点的"吸引域"。对于多峰或平坦的目标函数表面，错误的初值将导致算法不可逆地陷入局部极值。MCMC算法则基于马尔可夫链的遍历性定理：只要迭代次数趋于无穷，链的状态分布将收敛于唯一的目标后验分布，而与初始状态无关。实验表明，即便将初始电子密度设定为偏离真值500%的极端值，经过约2000次迭代后，采样链仍能准确收敛至真值附近的高概率区域。

**奇点适应能力**：在等离子体截止频率（$f \to f_p$）或超材料谐振点附近，群时延曲线$\tau(f)$出现极陡峭的突变，导致目标函数的梯度趋于无穷大或发生数值震荡。这会使LM算法中的雅可比矩阵变得奇异或病态，引发数值崩溃。MCMC算法采用"零阶"采样策略，仅需计算似然函数值而无需计算导数。当随机游走到非物理的突变点时，理论误差急剧增大，似然概率$P \to 0$，Metropolis判据将以极大概率拒绝该次跳跃，迫使采样链自动"绕开"奇点区域。这种机制赋予了算法在处理非连续、非平滑甚至存在奇点的色散曲线时极强的稳定性。

---

## 本节小结

本节建立了基于Metropolis-Hastings MCMC方法的贝叶斯参数反演框架，为第4.2节提取的"频率-时延"特征数据与Drude物理模型之间搭建了完整的统计推断桥梁。主要研究成果总结如下：

**加权似然函数的物理设计（4.3.1）**。针对强色散条件下信噪比随频率剧烈变化的特点，构建了融合幅度权重的加权高斯似然函数（式4-45）。该设计将第4.2.1节提取的窗口幅度$A_i$显式纳入优化目标，使高信噪比区域的数据主导反演过程，有效抑制了截止频率附近低质量数据的干扰。同时，给出了基于全复数Drude模型的理论时延计算流程（式4-46至4-49），为后续MCMC迭代提供了精确的前向模型。

**MCMC采样策略与实现细节（4.3.2）**。采用均匀先验分布限定参数的物理可行域，基于Metropolis-Hastings算法实现后验分布的高效采样。详细阐述了"提议-接受/拒绝"的迭代流程（式4-52至4-53）和收敛诊断方法。算法设置包括：总采样数10000次，预烧期2000次，提议步长分别为参数范围的2%（$n_e$）和5%（$\nu_e$）。该实现方案在保证采样效率（目标接受率20%-50%）的同时，充分利用了MCMC对初值无关和奇点适应的特异性优势。

**参数可观测性量化判据（4.3.3）**。基于后验分布的形态特征，建立了以变异系数CV为核心的参数可观测性分级标准（式4-54）：CV < 5%为强可观测，CV ≥ 50%为不可观测。引入Corner Plot作为参数耦合的可视化诊断工具，能够直观揭示"平底谷"（参数不敏感）和"倾斜椭圆"（参数耦合）等关键结构。该判据将"参数是否应该反演"从主观经验提升为客观的数据驱动决策，为第4.4节验证"参数降维假设"提供了定量化工具。

综上所述，本节完成了从特征数据到物理参数的完整反演框架构建。贝叶斯方法不仅给出了参数的点估计（后验均值），更提供了置信区间（95% CI）和可观测性诊断（CV判据），实现了从"能否反演"到"反演精度如何"的全链条量化。第4.4节将基于Drude等离子体模型的仿真实验，对本节提出的方法进行系统验证，并通过Corner Plot直观展示$n_e$的"尖峰"后验与$\nu_e$的"平坦"后验之间的鲜明对比，为参数降维策略提供统计学实锤。
